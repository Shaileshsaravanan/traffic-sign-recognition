# Traffic Signs Detection and Classification in Real-Time

A new and improved version using Single Shot MultiBox Detector (SSD) is set to be released this summer. This update will provide higher accuracy for those who require a more precise detection method. Stay tuned for upcoming releases!

## 1. Project Overview

This project focuses on the real-time detection and classification of traffic signs in videos using OpenCV. The system is divided into two main phases: **detection** and **classification**.

### Detection Phase:

In the detection phase, Image Processing techniques are applied to each video frame to identify potential traffic signs. The steps involved include:

1. **Enhance Contrast**: Increase the contrast and dynamic range of the video frame.
2. **Color Filtering**: Remove unnecessary colors, such as green, using HSV color range.
3. **Edge Detection**: Apply the Laplacian of Gaussian to highlight object borders.
4. **Contour Creation**: Binarize the frame to create contours.
5. **Shape Detection**: Identify ellipse-like and circle-like contours as potential traffic sign candidates.

### Classification Phase:

In the classification phase, the identified candidates are cropped from the original frame. A pre-trained SVM model is then used to classify these images and determine the specific type of traffic sign.

**Currently Supported Traffic Signs:**

- The project supports multiple classes of traffic signs, with some grouped under "OTHERS" due to competition requirements.
- A special class (Class 0) is used for non-traffic-signs.

**Tracking and Model Details:**

- The system tracks detected traffic signs using Dense Optical Flow until they disappear or are replaced by a larger sign in the frame.
- The SVM model is trained each time `main.py` is run. The model is saved in `data_svm.dat` to enable future implementation of a model-reload function, avoiding the need for retraining each time.

## 2. Prerequisites

Ensure that you have the following dependencies installed:

- Python 3.5
- OpenCV 3
- Imutils (`pip3 install imutils`)

## 3. System Structure

### a. Python Files:

The system consists of three primary Python modules:

- **`main.py`**: The entry point of the program. It processes video frames in real-time, detects potential traffic signs, classifies them using a pre-trained SVM model, and tracks them across frames.
- **`classification.py`**: Contains the SVM model used to classify traffic signs.
- **`common.py`**: Provides utility functions for defining the SVM model.
- **`data_svm.dat`**: Stores the trained SVM model.

### c. Dataset:

The `Dataset` folder contains images for training the SVM model. This folder is divided into 12 subfolders, each corresponding to a specific traffic sign class. The special `0` folder contains non-traffic-sign images that might be mistakenly detected as traffic signs.

The dataset is generated by applying the detection phase to various videos and manually categorizing the detected traffic signs into their appropriate classes. Each time the program is run, the dataset can be updated by checking and correcting any misclassified traffic signs.

## 4. Installation

You can run the program in two ways:

### Using Default Arguments:

```bash
python3 main/main.py --file_name video.mp4
```

### Using Custom Arguments:

```bash
python3 main/main.py --file_name video.mp4 [options]
```

#### Optional Arguments:

- `-h, --help`: Show help message and exit.
- `--file_name FILE_NAME`: Specify the video file to be analyzed.
- `--min_size_components MIN_SIZE_COMPONENTS`: Set the minimum size component to be reserved.
- `--similarity_contour_with_circle SIMILARITY_CONTOUR_WITH_CIRCLE`: Set the similarity threshold to a circle.

## 5. Results

The system outputs the detected and classified traffic signs in real-time as it processes the video.

## 6. Limitations

- **Static Image Processing**: Parameters need to be updated for each video with different lighting conditions.
- **Detection Accuracy**: The detection phase may miss signs or detect incorrect areas.
- **Overfitting**: The dataset is slightly overfitted, which may affect the classification phase.

## 7. Future Developments

- Improve performance with higher frame rates.
- Explore other detection methods like YOLO or SSD.
- Implement dynamic image processing techniques.
- Incorporate CNNs for classification.
- Remove the need for retraining the model each time the program is run.
- Expand and diversify the dataset.

## 8. Project Structure

The codebase is organized into three main folders:

- **`main/`**: Contains the main program files.
- **`test/`**: Includes testing scripts and files.
- **`train/`**: Holds the training scripts and dataset.

## 9. Explanation of `main.py`

The `main.py` script is the entry point for the traffic sign detection and classification system. The script processes video frames in real-time, detects potential traffic signs, and classifies them using a pre-trained SVM model. The detected signs are then tracked throughout the video using optical flow techniques.

Here's a step-by-step breakdown of what happens in `main.py`:

1. **Importing Necessary Libraries**:
   - The script imports various libraries, including `cv2` (OpenCV), `numpy`, and others for image processing, blob detection, argument parsing, and file handling.

2. **Defining Traffic Sign Labels**:
   - The `SIGNS` list defines the different types of traffic signs that the model can classify, such as "STOP", "TURN LEFT", "ONE WAY", etc.

3. **Cleaning Up Old Files**:
   - The `clean_images()` function removes any previously generated image files in the `main/` directory. This ensures that the output directory is clean before processing new video frames.

4. **Preprocessing the Image**:
   - Several functions are defined to preprocess images:
     - `constrastLimit(image)` enhances the contrast of the image.
     - `LaplacianOfGaussian(image)` applies a Laplacian of Gaussian filter to detect edges.
     - `binarization(image)` converts the image into a binary (black and white) format.
     - `preprocess_image(image)` combines the above steps to prepare the image for further processing.

5. **Traffic Sign Detection**:
   - Functions like `removeSmallComponents(image, threshold)`, `findContour(image)`, `contourIsSign(perimeter, centroid, threshold)`, etc., work together to detect contours in the processed image. Contours that resemble traffic signs are identified and cropped.

6. **Localization and Classification**:
   - The `localization()` function processes each video frame, detects potential signs, classifies them using the SVM model, and draws bounding boxes and labels around the detected signs.

7. **Tracking Detected Signs**:
   - The script uses optical flow (CamShift algorithm) to track the detected signs across subsequent frames.

8. **Video Processing Loop**:
   - The main loop reads frames from the video file, processes each frame to detect and classify traffic signs, and outputs the processed video with labeled signs.

### Enabling and Using Command-Line Arguments

The script uses the `argparse` library to handle command-line arguments, which allows users to customize how the script runs. Here's how arguments are enabled and used in the script:

1. **Argument Parsing**:
   - The `argparse` library is used to define and parse command-line arguments. This is done using the `argparse.ArgumentParser` class. In the `main()` function, arguments are defined using the `add_argument()` method.

2. **Available Arguments**:
   - `--file_name`: Specifies the path to the video file to be analyzed.
   - `--min_size_components`: Sets the minimum size of connected components to be reserved during processing.
   - `--similarity_contour_with_circle`: Sets the similarity threshold to a circle, used in contour detection.

3. **Usage**:
   - Users can run the script with default settings or customize the execution using arguments. For example:
     - Default execution: `python3 main/main.py --file_name video.mp4`
     - Custom execution: `python3 main/main.py --file_name video.mp4 --min_size_components 150 --similarity_contour_with_circle 0.7`
